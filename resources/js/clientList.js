var chatHistory,offset=0,limit=50,totalRecord=0,currentPage=0,ordered_by="request_date",order_type="asc";function getConversationIds(){$("#searchConversationIdInUserInfo").select2({placeholder:"Search conversation id",minimumInputLength:1,allowClear:!0,maximumSelectionSize:1,multiple:!1,ajax:{url:"api/v1/searchConversationIdInUserInfo.do",dataType:"json",type:"POST",quietMillis:250,id:function(t){return t.conversation_id},data:function(t,a){return{q:t,page:a}},results:function(t,a){var e=30*a<t.jArray.length;return{results:t.jArray,more:e}}},formatResult:function(t){return t.conversation_id},formatSelection:function(t){return t.conversation_id},initSelection:function(t,a){var e=[];""!=t.val()&&$.each(t.val().split(","),function(t,a){e.push({id:a,text:a})}),a(e)},dropdownCssClass:"bigdrop",escapeMarkup:function(t){return t}})}function getConversationHistoryDates(){$.ajax({url:"api/v1/getConversationHistoryDates.do",method:"POST",async:!1,data:{}}).done(function(t){if(null!=t){response=$.parseJSON(t);var a=response.min_date,e=response.max_date,o=a.split("-"),d=e.split("-"),r=o[1]+"/"+o[2]+"/"+o[0],n=d[1]+"/"+d[2]+"/"+d[0];$("#startDate").val(r),$("#endDate").val(n),show_min_date=a,show_max_date=e,$("#startDate").datepicker("option","maxDate",new Date(d[0],d[1]-1,d[2])).datepicker("option","minDate",new Date(o[0],o[1]-1,o[2])),$("#endDate").datepicker("option","maxDate",new Date(d[0],d[1]-1,d[2])).datepicker("option","minDate",new Date(o[0],o[1]-1,o[2]))}}).fail(function(){})}function createDateAsUTC(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}$(document).ready(function(){$(".nobtnptr3").addClass("nohovermenu"),$(".nobtnptr3").css({"pointer-events":"none",background:"#ccc"}),$(".nobtnptr3 a").css("color","#000"),checkSession(),$("#loadData").hide(),chatHistory.channelList(),getConversationIds(),$("#historySpinner").hide(),$("#startDate").change(function(){$("#idtable").hide(),$("#PDFExportId").hide(),$("#ExcelExportId").hide(),$("#loadData").hide(),$("#conersation_history").attr("disabled",!1),$("#historySpinner").hide()}),$("#endDate").change(function(){$("#idtable").hide(),$("#PDFExportId").hide(),$("#ExcelExportId").hide(),$("#loadData").hide(),$("#conersation_history").attr("disabled",!1),$("#historySpinner").hide()}),$("#channelList").change(function(){$("#idtable").hide(),$("#PDFExportId").hide(),$("#ExcelExportId").hide(),$("#loadData").hide(),$("#conersation_history").attr("disabled",!1),$("#historySpinner").hide()}),$("#searchConversationIdInUserInfo").on("change",function(t){$("#idtable").hide(),$("#PDFExportId").hide(),$("#ExcelExportId").hide(),$("#loadData").hide(),$("#conersation_history").attr("disabled",!1),$("#historySpinner").hide()}),$("#startDate").datetimepicker({pickTime:!1,format:"YYYY-MM-DD",defaultDate:new Date}),$("#endDate").datetimepicker({pickTime:!1,format:"YYYY-MM-DD",defaultDate:new Date}),$("#loadData").on("click",function(){chatHistory.loadMoreData()})}),chatHistory={showAll:function(){},channelList:function(){var r="<option value=''>All</option>";$("#channelList").html(r),$.ajax({url:"api/v1/getAvivaPlan",method:"POST",async:!1,data:{},success:function(t){var a=$.parseJSON(t),e=a.status;if(200==e)for(var o=0;o<a.data.length;o++){var d=a.data[o];r+='<option value="'+d+'">'+d+"</option>"}else r=e;$("#channelList").html(r)}}).fail(function(){bootbox.alert({size:"small",message:"Internal Server Error.",callback:function(){}})})},loadMoreData:function(){$("#loadData").hide(),$("#historySpinner").show();$("#searchIpAddress").select2("val").toString();var t=$("#startDate").val(),a=$("#endDate").val(),e=$("#channelList").val(),d="",r=1;offset+=limit,$.ajax({url:"api/v1/getUserRequestList",method:"POST",async:!0,data:{offset:offset,limit:limit,orderby:ordered_by,ordertype:order_type,plan:e,conversationid:"",startdate:t,enddate:a,export_type:"other"},success:function(t){var a,e=(a=$.parseJSON(t)).status;if(totalRecord=a.totalRecords,r=a.totalPages,0<(a=$.parseJSON(t)).data.data.length){e=a.status;if(totalRecord=a.data.totalRecords,r=a.data.totalPages,"200"==e){tempFlag=!1;for(var o=0;o<a.data.data.length;o++){d+="<tr>",d+="<td>"+a.data.data[o].plan+"</td>",d+="<td>"+a.data.data[o].name+"</td>",d+="<td>"+a.data.data[o].age+"</td>",d+="<td>"+a.data.data[o].child_age+"</td>",d+="<td>"+a.data.data[o].gender+"</td>",d+="<td>"+a.data.data[o].mobile+"</td>",d+="<td>"+a.data.data[o].email+"</td>",d+="<td>"+a.data.data[o].sa+"</td>",d+="<td>"+a.data.data[o].term+"</td>",d+="<td>"+a.data.data[o].premium+"</td>",d+="<td>"+a.data.data[o].mb1+"</td>",d+="<td>"+a.data.data[o].mb2+"</td>",d+="<td>"+a.data.data[o].mb3+"</td>",d+="<td>"+a.data.data[o].maturity+"</td>",d+="<td>"+a.data.data[o].tf+"</td>",d+="<td>"+a.data.data[o].caf+"</td>",d+="<td>"+a.data.data[o].ppt+"</td>",d+="<td>"+a.data.data[o].requestDate+"</td>",d+=" </tr>"}}else d=e;$("#tblConvBody").append(d),$("#historySpinner").hide(),$("input[type=button]").removeAttr("onclick"),$("input[type=button]").removeClass("submitbtn").addClass("submitbtnColr"),$(":button").removeAttr("onclick"),$(":button").each(function(){$(this).hasClass("optionbtn")&&$(this).removeClass("optionbtn").addClass("optionbtncolor"),$(this).hasClass("submitbtn")&&$(this).removeClass("submitbtn").addClass("submitbtnColr")}),$(".hideBtns").attr("style","pointer-events:none"),$(".newdeviceform").attr("style","pointer-events:none"),$("#conersation_history").removeClass("optionbtncolor"),$("#conersation_history").removeClass("submitbtnColr"),$("#loadData").removeClass("optionbtncolor").removeClass("submitbtnColr"),(currentPage=offset/limit+1)<r?$("#loadData").show():$("#loadData").hide()}}}).fail(function(){checkSession(),bootbox.alert({size:"small",message:"Internal Server Error.",callback:function(){}})})},shortBy:function(t,a,e){$("#historySpinner").show();$("#searchIpAddress").select2("val").toString();var o=$("#startDate").val(),d=$("#endDate").val(),r=$("#channelList").val(),n="";offset=0;var s=1;a&&($("#idtable th").removeClass("footable-sorted-desc").removeClass("footable-sorted"),order_type="asc"),order_type=$("#"+t).hasClass("footable-sorted-desc")||!$("#"+t).hasClass("footable-sorted-desc")&&!$("#"+t).hasClass("footable-sorted")?"asc":"desc",a&&$("#"+t).addClass("footable-sorted"),"conversation_id"==t?ordered_by="conversation_id":"plan"==t?ordered_by="plan":"name"==t?ordered_by="name":"mobile"==t?ordered_by="mobile":"email_id"==t?ordered_by="email_id":"date"==t?ordered_by="request_date":"age"==t?ordered_by="age":"gender"==t?ordered_by="gender":"child_age"==t?ordered_by="child_age":"sa"==t?ordered_by="sa":"term"==t?ordered_by="term":"premium"==t?ordered_by="premium":"mb1"==t?ordered_by="mb1":"mb2"==t?ordered_by="mb2":"mb3"==t?ordered_by="mb3":"maturity"==t?ordered_by="maturity":"tf"==t?ordered_by="tf":"caf"==t?ordered_by="caf":"ppt"==t&&(ordered_by="ppt"),o?d?$("#startDate").val()>$("#endDate").val()?bootbox.alert({size:"small",message:"Start date should be earlier to end date.",callback:function(){$("#historySpinner").hide()}}):$("#endDate").val()<$("#startDate").val()?bootbox.alert({size:"small",message:"End date can never be less than start date.",callback:function(){}}):(console.log("find short :- "+ordered_by+" by function :- "+order_type),$.ajax({url:"api/v1/getUserRequestList",method:"POST",async:!0,data:{offset:offset,limit:limit,orderby:ordered_by,ordertype:order_type,plan:r,conversationid:"",startdate:o,enddate:d,export_type:"other"},success:function(t){var a=$.parseJSON(t);if(0<a.data.data.length){var e=a.status;if(totalRecord=a.data.totalRecords,s=a.data.totalPages,currentPage=1,"200"==e){tempFlag=!1;for(var o=0;o<a.data.data.length;o++){n+="<tr>",n+="<td>"+a.data.data[o].plan+"</td>",n+="<td>"+a.data.data[o].name+"</td>",n+="<td>"+a.data.data[o].age+"</td>",n+="<td>"+a.data.data[o].child_age+"</td>",n+="<td>"+a.data.data[o].gender+"</td>",n+="<td>"+a.data.data[o].mobile+"</td>",n+="<td>"+a.data.data[o].email+"</td>",n+="<td>"+a.data.data[o].sa+"</td>",n+="<td>"+a.data.data[o].term+"</td>",n+="<td>"+a.data.data[o].premium+"</td>",n+="<td>"+a.data.data[o].mb1+"</td>",n+="<td>"+a.data.data[o].mb2+"</td>",n+="<td>"+a.data.data[o].mb3+"</td>",n+="<td>"+a.data.data[o].maturity+"</td>",n+="<td>"+a.data.data[o].tf+"</td>",n+="<td>"+a.data.data[o].caf+"</td>",n+="<td>"+a.data.data[o].ppt+"</td>",n+="<td>"+a.data.data[o].requestDate.replace(".0","")+"</td>",n+=" </tr>"}}else n=e;$("#tblConvBody").empty().html(n),$("#conersation_history").attr("disabled",!0),$("#historySpinner").hide(),$("input[type=button]").removeAttr("onclick"),$("input[type=button]").removeClass("submitbtn").addClass("submitbtnColr"),$(":button").removeAttr("onclick"),$(":button").each(function(){$(this).hasClass("optionbtn")&&$(this).removeClass("optionbtn").addClass("optionbtncolor"),$(this).hasClass("submitbtn")&&$(this).removeClass("submitbtn").addClass("submitbtnColr")}),$(".hideBtns").attr("style","pointer-events:none"),$(".newdeviceform").attr("style","pointer-events:none"),$("#conersation_history").removeClass("optionbtncolor"),$("#conersation_history").removeClass("submitbtnColr"),$("#loadData").removeClass("optionbtncolor").removeClass("submitbtnColr"),$("#idtable").footable(),$("#idtable").show(),$("#PDFExportId").show(),$("#ExcelExportId").show(),(currentPage=offset/limit+1)<s?$("#loadData").show():$("#loadData").hide()}else bootbox.alert({size:"small",message:"No data available for selected values.",callback:function(){$("#idtable").hide(),$("#PDFExportId").hide(),$("#ExcelExportId").hide(),$("#loadData").hide(),$("#conersation_history").attr("disabled",!1),$("#historySpinner").hide()}})}}).fail(function(){checkSession(),bootbox.alert({size:"small",message:"Internal Server Error.",callback:function(){}})})):bootbox.alert({size:"small",message:"Please enter end date.",callback:function(){}}):bootbox.alert({size:"small",message:"Please enter start date.",callback:function(){}})}};